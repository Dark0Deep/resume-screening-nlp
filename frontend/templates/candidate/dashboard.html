{% extends "base.html" %}

{% block title %}Candidate Dashboard{% endblock %}
{% block heading %}Welcome, {{ session.get("name") }}{% endblock %}

{% block content %}

<!-- ================= METRICS ================= -->
<div class="metrics">

  <div class="card">
    <h3>Resume Status</h3>
    <div class="metric-value {% if resumes and resumes[0].status == 'analyzed' %}green{% else %}yellow{% endif %}">
      {% if resumes and resumes[0].status == "analyzed" %}
        Analyzed
      {% else %}
        Not Analyzed
      {% endif %}
    </div>
  </div>

  <div class="card">
    <h3>Skills Detected</h3>
    <div class="metric-value blue">
      {% if resumes and resumes[0].skills %}
        {{ resumes[0].skills | length }}
      {% else %}
        0
      {% endif %}
    </div>
  </div>

</div>

<!-- ================= QUICK ACTIONS ================= -->
<div class="card">
  <h3>Quick Actions</h3>

  <div style="display:flex; gap:15px; flex-wrap:wrap;">
    <a href="/candidate/upload">
      <button>Upload New Resume</button>
    </a>

    <form method="POST" action="/analyze-resume">
      <button {% if not resumes %}disabled{% endif %}>
        Analyze Latest Resume
      </button>
    </form>


  </div>
</div>

<!-- ================= RESUME HISTORY ================= -->
<div class="card">
  <h3>Your Resume History</h3>

  {% if resumes and resumes|length > 0 %}
    <table>
      <tr>
        <th>Resume</th>
        <th>Status</th>
        <th>Skills</th>
        <th>Action</th>
      </tr>

      {% for r in resumes %}
      <tr>
        <td>{{ r.filename }}</td>

        <td>
          {% if r.status == "analyzed" %}
            <span class="status-pill status-shortlisted">Analyzed</span>
          {% else %}
            <span class="status-pill status-pending">Uploaded</span>
          {% endif %}
        </td>

        <td>
          {% if r.skills %}
            {{ r.skills | length }}
          {% else %}
            â€”
          {% endif %}
        </td>

        <td style="display:flex; gap:10px;">

          {% if r.status == "analyzed" %}
          <a href="/candidate/analysis/{{ r._id }}">
            <button>View</button>
          </a>
          {% endif %}

          <!-- DELETE (SAFE) -->
          <form method="POST"
                action="/candidate/delete-resume/{{ r._id }}"
                onsubmit="return confirm('Are you sure you want to delete this resume?');">
            <button type="submit" style="background:#ef4444;">Delete</button>
          </form>

        </td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p class="text-muted">No resumes uploaded yet.</p>
  {% endif %}
</div>

{% endblock %}
