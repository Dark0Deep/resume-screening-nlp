{% extends "base.html" %}

{% block title %}Manage Applicants{% endblock %}
{% block heading %}Manage Applicants{% endblock %}

{% block content %}

<!-- ================= JOB DETAILS ================= -->
<div class="card">
    <h2 style="margin-bottom:10px;">{{ job.title }}</h2>
    <p style="color:#94a3b8;">{{ job.description }}</p>
</div>

<!-- ================= APPLICANTS ================= -->
<div class="card" style="margin-top:30px;">
    <h3 style="margin-bottom:20px;">Applicants</h3>

    {% if applications and applications|length > 0 %}

    <table>
        <thead>
            <tr>
                <th>Candidate</th>
                <th>Resume</th>
                <th>ATS Score</th>
                <th>Skills</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>

        <tbody>
        {% for app in applications %}
        <tr>

            <!-- Candidate Info -->
            <td>
                <strong>{{ app.candidate_name }}</strong><br>
                <small style="color:#94a3b8;">{{ app.candidate_email }}</small>
            </td>

            <!-- Resume -->
            <td>{{ app.resume_filename }}</td>

            <!-- ATS -->
            <td>
                <strong>
                    {{ app.ats_score if app.ats_score is defined else app.match_score }}%
                </strong>
            </td>

            <!-- Skills -->
            <td>
                {% if app.skills %}
                    {{ app.skills | join(', ') }}
                {% else %}
                    â€”
                {% endif %}
            </td>

            <!-- Status -->
            <td>
                {% if app.status == "shortlisted" %}
                    <span class="status-pill status-shortlisted">Shortlisted</span>
                {% elif app.status == "rejected" %}
                    <span class="status-pill status-rejected">Rejected</span>
                {% else %}
                    <span class="status-pill status-pending">Pending</span>
                {% endif %}
            </td>

            <!-- Action -->
            <td style="display:flex; gap:8px; flex-wrap:wrap;">

                {% if app.status != "shortlisted" %}
                <form method="POST" action="/recruiter/update-application-status">
                    <input type="hidden" name="application_id" value="{{ app.application_id }}">
                    <input type="hidden" name="status" value="shortlisted">
                    <button type="submit" class="btn">Shortlist</button>
                </form>
                {% endif %}

                {% if app.status != "rejected" %}
                <form method="POST" action="/recruiter/update-application-status">
                    <input type="hidden" name="application_id" value="{{ app.application_id }}">
                    <input type="hidden" name="status" value="rejected">
                    <button type="submit" class="btn" style="background:#ef4444;">Reject</button>
                </form>
                {% endif %}

            </td>

        </tr>

        <!-- Resume Summary Row -->
        <tr>
            <td colspan="6" style="background:#0f172a; padding:15px; font-size:14px; color:#94a3b8;">
                <strong>Summary:</strong><br>
                {{ app.summary if app.summary else "No summary available." }}
            </td>
        </tr>

        {% endfor %}
        </tbody>
    </table>

    {% else %}

    <div style="padding:20px; text-align:center; color:#94a3b8;">
         No applications yet for this job.
    </div>

    {% endif %}
</div>

{% endblock %}
